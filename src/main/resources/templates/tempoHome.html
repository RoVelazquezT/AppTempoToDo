<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Tempo To Do - Home</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
			integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
	<link rel="stylesheet" th:href="@{/css/styleHome.css}">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
	<meta name="_csrf" th:content="${_csrf.token}" />
	<meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>

<body>
	<!-- Barra de navegacion -->
	<nav class="navbar fixed-top bg-dark navbar-dark my-2">
		<div class="container-fluid">
			<div class="d-flex ms-auto gap-2 align-items-center">

				<h3 class="text-light d-none d-lg-block">
					Bienvenid@, <span th:text="${user.username} ?: ''"></span>
				</h3>

				<form th:action="@{/logout}" method="post" class="m-0 mx-5 d-none d-lg-block">
					<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
					<button type="submit" class="btn btn-danger">Cerrar Sesi√≥n</button>
				</form>

				<button class="navbar-toggler d-lg-none  " type="button" data-bs-toggle="offcanvas"
					data-bs-target="#offcanvasDarkNavbar" aria-controls="offcanvasDarkNavbar"
					aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasDarkNavbar"
					aria-labelledby="offcanvasDarkNavbarLabel">
					<div class="offcanvas-header">
						<h5 class="offcanvas-title" id="offcanvasDarkNavbarLabel">Men√∫</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
							aria-label="Close"></button>
					</div>
					<div class="offcanvas-body">
						<ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
							<li class="nav-item">
								<a class="nav-link" th:href="@{/create-task}">Crear Tarea</a>
							</li>
							<li class="nav-item">
								<form th:action="@{/logout}" method="post">
									<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
									<button type="submit" class="btn btn-danger">Cerrar Sesi√≥n</button>
								</form>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</nav>


	<!-- Seccion principal -->
	<div class="container-principal">

		<!-- Seccion Completadas -->
		<div class="seccion todo-app">
			<h2>Tasks Done <img th:src="@{/images/check.png}"></h2>
			<div class="seccion-completed" style="max-height: 500px; overflow-y: auto;">

				<div class="card my-3" style="width: 20 rem;" th:each="task : ${completed}">
					<div class="card-body">
						<h5 class="card-title text-decoration-line-through" th:text="${task.title}"></h5>
						<p class="card-text" th:text="${task.description}"></p>
						<p class="card-date d-none" th:text="${task.createDate}"></p>
						<div class="d-flex justify-content-around">
							<button class="btn-delete" th:attr="data-id=${task.id}">‚ùå</button>

							<button class="btn-view" data-bs-toggle="modal" data-bs-target="#detailModal">üîç</button>
						</div>
					</div>
				</div>
				<div th:if="${completed == null or completed.empty}" class="text-center p-3">
					<p>No hay tareas completadas</p>
				</div>
			</div>
		</div>

		<div class="modal fade" id="detailModal" tabindex="-1">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Detalle Completo</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						<div class="mb-3">
							<h4 id="detail-title" class="text-decoration-line-through"></h4>
							<hr>
						</div>
						<div class="mb-3">
							<p id="detail-content" class="lead"></p>
						</div>
						<div class="mb-3">
							<small class="text-muted">Fecha de creaci√≥n: <span id="detail-date"></span></small>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Seccion Pendientes -->
		<div class="seccion todo-app">
			<h2>To-Do List <img th:src="@{/images/icon.png}"></h2>
			<div class="seccion-incomplete" style="max-height: 500px; overflow-y: auto;">
				<div class="card-incomplete" style="max-height: 500px; overflow-y: auto;">

					<!-- Cards de pendientes -->
					<div class="card my-3" style="width: 17rem;" th:each="task : ${pending}">
						<div class="card-body">
							<h5 class="card-title" th:text="${task.title}"></h5>
							<p class="card-text" th:text="${task.description}"></p>
							<p class="fch">
								Fecha: <span th:text="${#temporals.format(task.createDate, 'yyyy/MM/dd')}"></span>
							</p>
							<div class="d-flex justify-content-around">
								<button class="btn-done" th:attr="data-id=${task.id}">‚úÖ</button>

								<button class="btn-edit" data-bs-toggle="modal" data-bs-target="#editModal"
									th:attr="data-id=${task.id}" th:data-title="${task.title}"
									th:data-content="${task.description}">‚úèÔ∏è</button>
							</div>
						</div>
					</div>

					<!-- Mensaje si no hay pendientes -->
					<div th:if="${pending == null or pending.empty}" class="text-center p-3">
						<p>No hay tareas pendientes</p>
					</div>

				</div>
			</div>
		</div>


		<!-- Modal de Edici√≥n -->
		<div class="modal fade" id="editModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Actualizar Tarea</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
					</div>
					<div class="modal-body">
						<form id="editForm">
							<div class="mb-3">
								<label class="form-label">T√≠tulo</label>
								<input type="text" class="form-control" id="edit-title">
							</div>
							<div class="mb-3">
								<label class="form-label">Descripci√≥n</label>
								<textarea class="form-control" maxlength="250" id="edit-content" rows="3"></textarea>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
						<button type="button" class="btn btn-primary " id="save-changes">Guardar</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Seccion Create -->
		<div class="seccion seccion-create d-none d-lg-block" style="max-height: 600px; overflow-y: auto;">
			<div class="todo-app">
				<h2>Create <img th:src="@{/images/idea.png}"></h2>
				<div class="row">
					<form th:action="@{/save-task}" method="post" id="taskForm" class="p-3">
						<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
						<div class="mb-3">
							<label for="title" class="form-label">T√≠tulo</label>
							<input type="text" class="form-control" id="title" name="title"
								placeholder="Ingresar T√≠tulo..." required>
						</div>
						<div class="mb-3">
							<label for="description" class="form-label">Descripci√≥n</label>
							<textarea class="form-control" id="description" name="description" rows="3"
								placeholder="Descripci√≥n..." maxlength="250"></textarea>
						</div>
						<button type="submit" class="btn btn-light">Guardar Tarea</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
	<script th:src="@{/js/script.js}"></script>



</body>

</html>